name: "Auto Label Issues"
on:
  issues:
    types: [opened, edited]

jobs:
  label_issue:
    runs-on: ubuntu-latest
    steps:
      - name: "Extract and Apply Labels"
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const body = issue.body || "";

            console.log("Issue Body:", body); // Debugging Log

            // Define label mappings
            const severityLabels = {
              "ðŸŸ¥ Critical â€“ Breaks core functionality": "severity: critical",
              "ðŸŸ§ High â€“ Major issue, but workaround exists": "severity: high",
              "ðŸŸ¨ Medium â€“ Affects usability": "severity: medium",
              "ðŸŸ© Low â€“ Cosmetic, minor issue": "severity: low"
            };

            const urgencyLabels = {
              "ðŸ”¥ Immediate â€“ Blocks critical work": "urgency: immediate",
              "âš¡ High â€“ Should be fixed soon": "urgency: high",
              "â³ Medium â€“ Fix when possible": "urgency: medium",
              "ðŸ•°ï¸ Low â€“ Can be fixed later": "urgency: low"
            };

            // Extract selected values
            const severityMatch = body.match(/Severity.*?\*\*(.*?)\*\*/s);
            const urgencyMatch = body.match(/Urgency.*?\*\*(.*?)\*\*/s);

            console.log("Matched Severity:", severityMatch ? severityMatch[1] : "None");
            console.log("Matched Urgency:", urgencyMatch ? urgencyMatch[1] : "None");

            const labelsToAdd = [];

            if (severityMatch && severityLabels[severityMatch[1].trim()]) {
              labelsToAdd.push(severityLabels[severityMatch[1].trim()]);
            }

            if (urgencyMatch && urgencyLabels[urgencyMatch[1].trim()]) {
              labelsToAdd.push(urgencyLabels[urgencyMatch[1].trim()]);
            }

            if (labelsToAdd.length > 0) {
              console.log("Adding Labels:", labelsToAdd);
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labelsToAdd
              });
            } else {
              console.log("No labels to add.");
            }
