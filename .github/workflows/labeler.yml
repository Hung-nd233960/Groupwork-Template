name: "Auto Label Issues"
on:
  issues:
    types: [opened, edited]

jobs:
  label_issue:
    runs-on: ubuntu-latest
    steps:
      - name: "Check Issue for Severity & Urgency"
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const body = issue.body;
            
            // Define label mappings
            const severityLabels = {
              "ðŸŸ¥ Critical â€“ Breaks core functionality": "severity: critical",
              "ðŸŸ§ High â€“ Major issue, but workaround exists": "severity: high",
              "ðŸŸ¨ Medium â€“ Affects usability": "severity: medium",
              "ðŸŸ© Low â€“ Cosmetic, minor issue": "severity: low"
            };

            const urgencyLabels = {
              "ðŸ”¥ Immediate â€“ Blocks critical work": "urgency: immediate",
              "âš¡ High â€“ Should be fixed soon": "urgency: high",
              "â³ Medium â€“ Fix when possible": "urgency: medium",
              "ðŸ•°ï¸ Low â€“ Can be fixed later": "urgency: low"
            };

            // Extract selected values from issue body
            const severityMatch = body.match(/ðŸš¨ Severity.*?\*\*(.*?)\*\*/);
            const urgencyMatch = body.match(/â³ Urgency.*?\*\*(.*?)\*\*/);

            const labelsToAdd = [];

            if (severityMatch && severityLabels[severityMatch[1]]) {
              labelsToAdd.push(severityLabels[severityMatch[1]]);
            }

            if (urgencyMatch && urgencyLabels[urgencyMatch[1]]) {
              labelsToAdd.push(urgencyLabels[urgencyMatch[1]]);
            }

            if (labelsToAdd.length > 0) {
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labelsToAdd
              });
            }
