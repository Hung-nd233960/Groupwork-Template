name: "Auto Label Issues"
on:
  issues:
    types: [opened, edited]

jobs:
  label_issue:
    runs-on: ubuntu-latest
    steps:
      - name: "Check Issue for Severity & Urgency"
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const body = issue.body;
            
            // Define label mappings
            const severityLabels = {
              "🟥 Critical – Breaks core functionality": "severity: critical",
              "🟧 High – Major issue, but workaround exists": "severity: high",
              "🟨 Medium – Affects usability": "severity: medium",
              "🟩 Low – Cosmetic, minor issue": "severity: low"
            };

            const urgencyLabels = {
              "🔥 Immediate – Blocks critical work": "urgency: immediate",
              "⚡ High – Should be fixed soon": "urgency: high",
              "⏳ Medium – Fix when possible": "urgency: medium",
              "🕰️ Low – Can be fixed later": "urgency: low"
            };

            // Extract selected values from issue body
            const severityMatch = body.match(/🚨 Severity.*?\*\*(.*?)\*\*/);
            const urgencyMatch = body.match(/⏳ Urgency.*?\*\*(.*?)\*\*/);

            const labelsToAdd = [];

            if (severityMatch && severityLabels[severityMatch[1]]) {
              labelsToAdd.push(severityLabels[severityMatch[1]]);
            }

            if (urgencyMatch && urgencyLabels[urgencyMatch[1]]) {
              labelsToAdd.push(urgencyLabels[urgencyMatch[1]]);
            }

            if (labelsToAdd.length > 0) {
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labelsToAdd
              });
            }
